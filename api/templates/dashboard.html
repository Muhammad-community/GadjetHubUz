{% extends "base.html" %}
{% block title %}Dashboard â€“ GadgetHub{% endblock %}

{% block content %}
<div class="container" style="padding: 60px 0; max-width: 780px;">

  <!-- Header -->
  <div class="fade-up mb-4">
    <span class="section-label">Mening paneliim</span>
    <h1 class="mt-1">Xush kelibsiz, {{ user['username'] }} <span style="color:var(--accent)">ðŸ‘‹</span></h1>
    <p style="color:var(--muted)">Kunlik vazifalaringizni bu yerda boshqaring.</p>
  </div>

  <!-- Progress card -->
  <div class="card-dark p-4 mb-4 fade-up delay-1">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <span style="font-weight:600;">Bajarilgan vazifalar</span>
      <span style="color:var(--accent);font-family:'Syne',sans-serif;font-weight:800;">
        {{ done_count }} / {{ tasks|length }}
      </span>
    </div>
    <div style="background:var(--border);border-radius:99px;height:8px;overflow:hidden;">
      <div style="height:100%;border-radius:99px;
                  background:linear-gradient(90deg,var(--accent),var(--accent2));
                  width:{% if tasks|length > 0 %}{{ (done_count / tasks|length * 100)|int }}%{% else %}0%{% endif %};
                  transition:width 0.5s ease;"></div>
    </div>
  </div>

  <!-- Add task form -->
  <div class="card-dark p-4 mb-4 fade-up delay-2">
    <h5 class="mb-3">Yangi vazifa qo'shish</h5>
    <form action="{{ url_for('add_task') }}" method="POST" class="d-flex gap-2">
      <input type="text" name="title" placeholder="Vazifa nomi..." class="form-dark flex-grow-1" required maxlength="200" />
      <button type="submit" class="btn-accent btn px-4">
        <i class="bi bi-plus-lg me-1"></i>Qo'shish
      </button>
    </form>
  </div>

  <!-- Task list -->
  <div class="fade-up delay-3">
    {% if tasks %}
      {% for task in tasks %}
      <div class="card-dark mb-3 d-flex align-items-center gap-3 px-4 py-3 flex-wrap"
           style="{% if task['done'] %}opacity:0.55;{% endif %}border-radius:14px;">

        <!-- Toggle done button -->
        <form action="{{ url_for('toggle_task', task_id=task['id']) }}" method="POST" class="mb-0">
          <button type="submit"
                  style="width:26px;height:26px;border-radius:50%;border:2px solid {% if task['done'] %}var(--success){% else %}var(--border){% endif %};
                         background:{% if task['done'] %}var(--success){% else %}transparent{% endif %};
                         cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
            {% if task['done'] %}
              <i class="bi bi-check" style="color:#0a0c12;font-size:0.85rem;"></i>
            {% endif %}
          </button>
        </form>

        <!-- Task title -->
        <span style="flex:1;{% if task['done'] %}text-decoration:line-through;color:var(--muted);{% endif %}">
          {{ task['title'] }}
        </span>

        <!-- Date -->
        <span style="color:var(--muted);font-size:0.78rem;">
          {{ task['created_at'][:10] }}
        </span>

        <!-- Delete button -->
        <form action="{{ url_for('delete_task', task_id=task['id']) }}" method="POST" class="mb-0">
          <button type="submit"
                  style="background:rgba(255,79,106,0.12);border:1px solid rgba(255,79,106,0.25);
                         color:var(--danger);border-radius:8px;padding:4px 10px;cursor:pointer;font-size:0.85rem;"
                  onclick="return confirm('Vazifani o\'chirasizmi?')">
            <i class="bi bi-trash"></i>
          </button>
        </form>
      </div>
      {% endfor %}
    {% else %}
      <!-- Empty state -->
      <div class="text-center py-5" style="color:var(--muted);">
        <i class="bi bi-check2-all" style="font-size:3rem;opacity:0.3;"></i>
        <p class="mt-3">Hali birorta vazifa yo'q. Yuqoridagi forma orqali qo'shing!</p>
      </div>
    {% endif %}
  </div>

</div>
{% endblock %}
